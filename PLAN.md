# План доработки Task Nudge Extension

## Текущие проблемы
- Настройки не те (много ненужных отдельных вопросов)
- Нет голосового взаимодействия
- Нет интеграции с ChatGPT
- Нет анализа Git изменений между опросами
- Нет персонализированных сообщений

## Новая архитектура

### 1. Настройки (package.json)
```json
{
  "taskNudge.enabled": boolean,
  "taskNudge.baseIntervalMinutes": number,
  "taskNudge.maxIntervalMinutes": number,
  "taskNudge.idleThresholdSeconds": number,
  "taskNudge.questions": string[], // Список вопросов для разработчика
  "taskNudge.openaiApiKey": string, // Ключ OpenAI
  "taskNudge.voiceEnabled": boolean, // Включить голос
  "taskNudge.voiceLanguage": "ru" | "en" // Язык озвучивания
}
```

### 2. Git диффы - сохранение и сравнение
- Сохранять snapshot Git diff при каждом опросе в workspaceState
- Сравнивать текущий diff с предыдущим
- Определять: есть ли новые изменения или разработчик "застрял"

### 3. Голосовое взаимодействие
- Web Speech API для озвучивания (speechSynthesis)
- Динамическая генерация фраз через ChatGPT:
  - "Я вижу что ты застрял" (если diff не изменился)
  - "Я вижу ты сделал X, Y, Z" (если есть новые изменения)
  - Подбадривающие фразы после анализа ответов

### 4. ChatGPT интеграция
- Генерация персонализированных сообщений на основе Git diff
- Анализ ответов разработчика
- Генерация подбадривающих фраз

### 5. Новый флоу
1. **Детекция неактивности** → таймер
2. **Анализ Git diff** → сравнение с предыдущим snapshot
3. **Генерация сообщения** (ChatGPT) → на основе diff анализа
4. **Голосовое сообщение** + **всплывающее уведомление**
5. Если согласие → **текстовые вопросы в чате** (по списку из настроек)
6. **Анализ ответов** (ChatGPT) → **голосовая поддержка**

## Файлы для изменения

### Новые файлы:
- `src/openai.ts` - интеграция с ChatGPT
- `src/voice.ts` - голосовое озвучивание
- `src/gitSnapshot.ts` - сохранение и сравнение Git состояний

### Изменяемые файлы:
- `package.json` - новые настройки
- `src/types.ts` - новые интерфейсы
- `src/config.ts` - обновленная конфигурация
- `src/extension.ts` - новый флоу
- `src/dialog.ts` - интеграция с голосом и ChatGPT
- `src/state.ts` - сохранение Git snapshots

## Этапы реализации

### Этап 1: Обновление настроек и типов
- [x] Обновить package.json с новыми настройками
- [x] Обновить types.ts с новыми интерфейсами
- [x] Обновить config.ts

### Этап 2: Git snapshots
- [x] Создать gitSnapshot.ts для сохранения/сравнения
- [x] Интегрировать в основной флоу

### Этап 3: OpenAI интеграция
- [x] Создать openai.ts
- [x] Методы для генерации сообщений и анализа

### Этап 4: Голосовое озвучивание
- [x] Создать voice.ts
- [x] Интегрировать Web Speech API (базовая версия)

### Этап 5: Обновление основного флоу
- [x] Обновить extension.ts
- [x] Обновить dialog.ts
- [x] Обновить state.ts
- [x] Компиляция успешна

### Этап 6: Тестирование (следующий шаг)
- [ ] Протестировать новый флоу
- [ ] Настроить API ключ OpenAI
- [ ] Проверить голосовое озвучивание

## Ключевые моменты
- Сохранять Git diff snapshot после каждого опроса
- Голос должен быть основным способом взаимодействия
- ChatGPT генерирует персонализированный контент
- Текстовые вопросы только после согласия пользователя
- Дебаг: выводить ответы разработчика текстом